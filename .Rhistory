} else if (result <= (5/6)) {
return(5)
} else {
return(6)
}
}
sortTeams <- function(df) {
df$WinPCT <- as.numeric(df$WinPCT)
df_sorted <- df[order(df$WinPCT), ]
return(df_sorted)
}
run_process <- function(prev_data, next_data, team_id, matrix) {
next_teams_list <- next_data$teamID
if (team_id %in% next_teams_list) {
prev_teams_list <- prev_data$teamID
prev_team_idx <- which(prev_teams_list == team_id)
prev_win_bucket <- sort_bucket(prev_team_idx, length(prev_teams_list))
next_team_idx <- which(next_teams_list == team_id)
next_win_bucket <- sort_bucket(next_team_idx, length(next_teams_list))
matrix[prev_win_bucket, next_win_bucket] <-
matrix[prev_win_bucket, next_win_bucket] + 1
}
return(matrix)
}
total_interations = 0
year_count = 0
counts_matrix <- matrix(0, nrow = 6, ncol = 6)
for (year in 1969:2012) {
if (year_count == 0) {
prev_standings <- get_standings(year)
next_standings <- get_standings(year + 1)
} else {
prev_standings = next_standings
next_standings <- get_standings(year + 1)
}
Sys.sleep(1)
year_count = year_count + 1
print(year)
prev_order <- sortTeams(prev_standings)
next_order <- sortTeams(next_standings)
team_nums = prev_standings$teamID
for (team_num in team_nums) {
if (total_interations == 0) {
changing_matrix <- run_process(prev_order, next_order, team_num, counts_matrix)
} else {
changing_matrix <- run_process(prev_order, next_order, team_num, changing_matrix)
}
total_interations = total_interations + 1
}
}
row_sums = rowSums(changing_matrix)
header_names <- c("Worst 5 Teams", "Teams 25-21",
"Teams 20-16", "Teams 15-11",
"Teams 10-6", "Top 5 Teams")
normalized_matrix <- sweep(changing_matrix, 1, row_sums, FUN = "/")
rowSums(normalized_matrix)
titled_matrix <- normalized_matrix
colnames(titled_matrix) <- header_names
rownames(titled_matrix) <- header_names
matrix_k = normalized_matrix
for (i in 1:3){
matrix_k = matrix_k %*% normalized_matrix
}
write_csv(as.data.frame(normalized_matrix), here("datasets", "MLBNorm.csv"), col_names = TRUE)
library(dplyr)
library(readr)
library(here)
#dat <- read.csv("http://www.habitatring.com/standings.csv")
dat <- read_csv(here("datasets", "nfl_imported_standings.csv"))
dat
get_standings <- function(year) {
spec_df <- dat %>% filter(season == year)
spec_df$WinPCT <- spec_df$pct
spec_df$teamID <- spec_df$team
if ("STL" %in% spec_df$teamID) {
idx <-  which(spec_df$teamID == "STL")
spec_df[idx, "teamID"] <- "LA"
}
if ("SD" %in% spec_df$teamID) {
idx <-  which(spec_df$teamID == "SD")
spec_df[idx, "teamID"] <- "LAC"
}
return(spec_df[,c("teamID", "WinPCT")])
}
sort_bucket <- function(inverse_rank, numTeams) {
result <- inverse_rank / numTeams
if (result <= (1/6)) {
return(1)
} else if (result <= (2/6)) {
return(2)
} else if (result <= (3/6)) {
return(3)
} else if (result <= (4/6)) {
return(4)
} else if (result <= (5/6)) {
return(5)
} else {
return(6)
}
}
sortTeams <- function(df) {
df$WinPCT <- as.numeric(df$WinPCT)
df_sorted <- df[order(df$WinPCT), ]
return(df_sorted)
}
run_process <- function(prev_data, next_data, team_id, matrix) {
next_teams_list <- next_data$teamID
if (team_id %in% next_teams_list) {
prev_teams_list <- prev_data$teamID
prev_team_idx <- which(prev_teams_list == team_id)
prev_win_bucket <- sort_bucket(prev_team_idx, length(prev_teams_list))
next_team_idx <- which(next_teams_list == team_id)
next_win_bucket <- sort_bucket(next_team_idx, length(next_teams_list))
matrix[prev_win_bucket, next_win_bucket] <-
matrix[prev_win_bucket, next_win_bucket] + 1
}
else {
print(team_id)
}
return(matrix)
}
total_interations = 0
year_count = 0
counts_matrix <- matrix(0, nrow = 6, ncol = 6)
for (year in 2002:2016) {
if (year_count == 0) {
prev_standings <- get_standings(year)
next_standings <- get_standings(year + 1)
} else {
prev_standings = next_standings
next_standings <- get_standings(year + 1)
}
Sys.sleep(1)
year_count = year_count + 1
print(year)
prev_order <- sortTeams(prev_standings)
next_order <- sortTeams(next_standings)
team_nums = prev_standings$teamID
for (team_num in team_nums) {
if (total_interations == 0) {
changing_matrix <- run_process(prev_order, next_order, team_num, counts_matrix)
} else {
changing_matrix <- run_process(prev_order, next_order, team_num, changing_matrix)
}
total_interations = total_interations + 1
}
}
row_sums = rowSums(changing_matrix)
header_names <- c("32-28", "27-23",
"22-17", "16-12",
"11-7", "6-1")
normalized_matrix <- sweep(changing_matrix, 1, row_sums, FUN = "/")
rowSums(normalized_matrix)
titled_matrix <- normalized_matrix
colnames(titled_matrix) <- header_names
rownames(titled_matrix) <- header_names
matrix_k = normalized_matrix
for (i in 1:3){
matrix_k = matrix_k %*% normalized_matrix
}
make_absorbing_4_to_6 <- function(P) {
# Check that P is a square matrix
if (!is.matrix(P) || nrow(P) != ncol(P)) {
stop("Input must be a square matrix")
}
n <- nrow(P)
# Define absorbing states (states 4 to 6, or up to n if n < 6)
absorbing_states <- intersect(4:6, 1:n)
# For each absorbing state, set its row to all zeros and put 1 on the diagonal
for (s in absorbing_states) {
P[s, ] <- 0
P[s, s] <- 1
}
return(P)
}
absorbed <- make_absorbing_4_to_6(normalized_matrix)
matrix_k = absorbed
for (i in 1:4){
matrix_k = matrix_k %*% absorbed
}
sum(matrix_k[1, 1:3])
write_csv(as.data.frame(normalized_matrix), here("datasets", "NFLNorm.csv"), col_names = TRUE)
library(here)
library(r)
library(here)
library(readr)
library(dplyr)
# https://www.kaggle.com/datasets/datascientist97/hockey-teams-data-2024
standings <- read_csv(here("datasets", "NHL_Scraped_data.csv"))
get_standings <- function(year) {
year_df <- standings %>% filter(Year == year)
year_df$OT.Losses[is.na(year_df$OT.Losses)] <- 0
year_df$teamID <- year_df$Team.Name
year_df$points <- 2 * year_df$Wins + 1 * year_df$OT.Losses
if ("Minnesota North Stars" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Minnesota North Stars")
year_df[idx, "teamID"] <- "Dallas Stars"
}
if ("Quebec Nordiques" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Quebec Nordiques")
year_df[idx, "teamID"] <- "Colorado Avalanche"
}
if ("Winnipeg Jets" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Winnipeg Jets")
year_df[idx, "teamID"] <- "Phoenix Coyotes"
}
if ("Hartford Whalers" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Hartford Whalers")
year_df[idx, "teamID"] <- "Carolina Hurricanes"
}
if ("Mighty Ducks of Anaheim" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Mighty Ducks of Anaheim")
year_df[idx, "teamID"] <- "Anaheim Ducks"
}
return(year_df[,c("teamID", "points")])
}
sort_bucket <- function(inverse_rank, numTeams) {
result <- inverse_rank / numTeams
if (result <= (1/6)) {
return(1)
} else if (result <= (2/6)) {
return(2)
} else if (result <= (3/6)) {
return(3)
} else if (result <= (4/6)) {
return(4)
} else if (result <= (5/6)) {
return(5)
} else {
return(6)
}
}
sortTeams <- function(df) {
df$points <- as.numeric(df$points)
df_sorted <- df[order(df$points), ]
return(df_sorted)
}
run_process <- function(prev_data, next_data, team_id, matrix) {
next_teams_list <- next_data$teamID
if (team_id %in% next_teams_list) {
prev_teams_list <- prev_data$teamID
prev_team_idx <- which(prev_teams_list == team_id)
prev_win_bucket <- sort_bucket(prev_team_idx, length(prev_teams_list))
next_team_idx <- which(next_teams_list == team_id)
next_win_bucket <- sort_bucket(next_team_idx, length(next_teams_list))
matrix[prev_win_bucket, next_win_bucket] <-
matrix[prev_win_bucket, next_win_bucket] + 1
}
else {
print(team_id)
}
return(matrix)
}
total_interations = 0
year_count = 0
counts_matrix <- matrix(0, nrow = 6, ncol = 6)
for (year in 1990:2008) {
if (year != 2004) {
if (year_count == 0) {
prev_standings <- get_standings(year)
next_standings <- get_standings(year + 1)
} else {
prev_standings = next_standings
if (year != 2003) {
next_standings <- get_standings(year + 1)
} else {
next_standings <- get_standings(year + 2)
}
}
Sys.sleep(1)
year_count = year_count + 1
print(year)
prev_order <- sortTeams(prev_standings)
next_order <- sortTeams(next_standings)
team_nums = prev_standings$teamID
for (team_num in team_nums) {
if (total_interations == 0) {
changing_matrix <- run_process(prev_order, next_order, team_num, counts_matrix)
} else {
changing_matrix <- run_process(prev_order, next_order, team_num, changing_matrix)
}
total_interations = total_interations + 1
}
}
}
standings
library(here)
library(readr)
library(dplyr)
# https://www.kaggle.com/datasets/datascientist97/hockey-teams-data-2024
standings <- read_csv(here("datasets", "NHL_Scraped_data.csv"))
get_standings <- function(year) {
year_df <- standings %>% filter(Year == year)
year_df$`OT Losses`[is.na(year_df$`OT Losses`)] <- 0
year_df$teamID <- year_df$`Team Name`
year_df$points <- 2 * year_df$Wins + 1 * year_df$`OT Losses`
if ("Minnesota North Stars" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Minnesota North Stars")
year_df[idx, "teamID"] <- "Dallas Stars"
}
if ("Quebec Nordiques" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Quebec Nordiques")
year_df[idx, "teamID"] <- "Colorado Avalanche"
}
if ("Winnipeg Jets" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Winnipeg Jets")
year_df[idx, "teamID"] <- "Phoenix Coyotes"
}
if ("Hartford Whalers" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Hartford Whalers")
year_df[idx, "teamID"] <- "Carolina Hurricanes"
}
if ("Mighty Ducks of Anaheim" %in% year_df$teamID) {
idx <-  which(year_df$teamID == "Mighty Ducks of Anaheim")
year_df[idx, "teamID"] <- "Anaheim Ducks"
}
return(year_df[,c("teamID", "points")])
}
sort_bucket <- function(inverse_rank, numTeams) {
result <- inverse_rank / numTeams
if (result <= (1/6)) {
return(1)
} else if (result <= (2/6)) {
return(2)
} else if (result <= (3/6)) {
return(3)
} else if (result <= (4/6)) {
return(4)
} else if (result <= (5/6)) {
return(5)
} else {
return(6)
}
}
sortTeams <- function(df) {
df$points <- as.numeric(df$points)
df_sorted <- df[order(df$points), ]
return(df_sorted)
}
run_process <- function(prev_data, next_data, team_id, matrix) {
next_teams_list <- next_data$teamID
if (team_id %in% next_teams_list) {
prev_teams_list <- prev_data$teamID
prev_team_idx <- which(prev_teams_list == team_id)
prev_win_bucket <- sort_bucket(prev_team_idx, length(prev_teams_list))
next_team_idx <- which(next_teams_list == team_id)
next_win_bucket <- sort_bucket(next_team_idx, length(next_teams_list))
matrix[prev_win_bucket, next_win_bucket] <-
matrix[prev_win_bucket, next_win_bucket] + 1
}
else {
print(team_id)
}
return(matrix)
}
total_interations = 0
year_count = 0
counts_matrix <- matrix(0, nrow = 6, ncol = 6)
for (year in 1990:2008) {
if (year != 2004) {
if (year_count == 0) {
prev_standings <- get_standings(year)
next_standings <- get_standings(year + 1)
} else {
prev_standings = next_standings
if (year != 2003) {
next_standings <- get_standings(year + 1)
} else {
next_standings <- get_standings(year + 2)
}
}
Sys.sleep(1)
year_count = year_count + 1
print(year)
prev_order <- sortTeams(prev_standings)
next_order <- sortTeams(next_standings)
team_nums = prev_standings$teamID
for (team_num in team_nums) {
if (total_interations == 0) {
changing_matrix <- run_process(prev_order, next_order, team_num, counts_matrix)
} else {
changing_matrix <- run_process(prev_order, next_order, team_num, changing_matrix)
}
total_interations = total_interations + 1
}
}
}
row_sums = rowSums(changing_matrix)
header_names <- c("Bottom 1/6 of Teams", "Tier 5",
"Tier 4", "Tier 3",
"Tier 2", "Top 1/6 of Teams")
normalized_matrix <- sweep(changing_matrix, 1, row_sums, FUN = "/")
rowSums(normalized_matrix)
titled_matrix <- normalized_matrix
colnames(titled_matrix) <- header_names
rownames(titled_matrix) <- header_names
matrix_k = normalized_matrix
for (i in 1:3){
matrix_k = matrix_k %*% normalized_matrix
}
make_absorbing_4_to_6 <- function(P) {
# Check that P is a square matrix
if (!is.matrix(P) || nrow(P) != ncol(P)) {
stop("Input must be a square matrix")
}
n <- nrow(P)
# Define absorbing states (states 4 to 6, or up to n if n < 6)
absorbing_states <- intersect(4:6, 1:n)
# For each absorbing state, set its row to all zeros and put 1 on the diagonal
for (s in absorbing_states) {
P[s, ] <- 0
P[s, s] <- 1
}
return(P)
}
absorbed <- make_absorbing_4_to_6(normalized_matrix)
matrix_k = absorbed
for (i in 1:5){
matrix_k = matrix_k %*% absorbed
}
write_csv(as.data.frame(normalized_matrix), here("datasets", "NHLNorm.csv"), col_names = TRUE)
library(here)
library(readr)
library(tibble)
library(dplyr)
NFL_norm <- as.matrix(read_csv(here("datasets", "NFLNorm.csv")))
MLB_norm <- as.matrix(read_csv(here("datasets", "MLBNorm.csv")))
NHL_norm <- as.matrix(read_csv(here("datasets", "NHLNorm.csv")))
NBA_norm <- as.matrix(read_csv(here("datasets", "NBANorm.csv")))
NFL_norm <- apply(NFL_norm, 2, as.numeric)
MLB_norm <- apply(MLB_norm, 2, as.numeric)
NHL_norm <- apply(NHL_norm, 2, as.numeric)
NBA_norm <- apply(NBA_norm, 2, as.numeric)
make_absorbing_4_to_6 <- function(P) {
# Check that P is a square matrix
if (!is.matrix(P) || nrow(P) != ncol(P)) {
stop("Input must be a square matrix")
}
n <- nrow(P)
# Define absorbing states (states 4 to 6, or up to n if n < 6)
absorbing_states <- intersect(4:6, 1:n)
# For each absorbing state, set its row to all zeros and put 1 on the diagonal
for (s in absorbing_states) {
P[s, ] <- 0
P[s, s] <- 1
}
return(P)
}
orig_matrices <- list(NFL_norm, MLB_norm, NHL_norm, NBA_norm)
new_matrices_func <- function(matrices) {
new_matrices <- list()
for (matrix in matrices) {
print(dim(matrix))
result <- make_absorbing_4_to_6(matrix)
new_matrices[[length(new_matrices) + 1]] <- result
}
return(new_matrices)
}
end_matrices <- new_matrices_func(orig_matrices)
to_power <- function(matrices) {
vals <- list()
for (matrix in matrices) {
matrix_k = matrix
for (i in 1:6){
matrix_k = matrix_k %*% matrix
}
vals <- c(vals, sum(matrix_k[1, 4:6]))
}
return(vals)
}
after_6_years = to_power(end_matrices)
library(expm)
library(ggplot2)
library(tidyr)
library(dplyr)
compute_row_sums <- function(mat) {
sapply(1:10, function(x) {
powered <- mat %^% x
sum(powered[1, 4:6])
})
}
# Compute row sums for each matrix
row_sums_list <- lapply(end_matrices, compute_row_sums)
# Combine into a data frame
df <- data.frame(
Power = 1:10,
NFL = row_sums_list[[1]],
MLB = row_sums_list[[2]],
NHL = row_sums_list[[3]],
NBA = row_sums_list[[4]]
)
# Reshape to long format for ggplot
df_long <- pivot_longer(df, cols = -Power, names_to = "Matrix", values_to = "RowSum")
# Reorder factor levels so legend shows NFL first
df_long$Matrix <- factor(df_long$Matrix, levels = c("NFL", "MLB", "NHL", "NBA"))
# Plot
comp_plot <- ggplot(df_long, aes(x = Power, y = RowSum, color = Matrix)) +
geom_line(size = 1.2) +
geom_point() +
theme_minimal() +
labs(title = "% of Going from Bottom Tier to Having an Above Average Team within X Years", x = "Years", y = "% Chance")
ggsave(here("plots", "comparison_plot.png"), plot=comp_plot)
df_edited = subset(df, select=-Power)
# Convert row names into a column named "Years"
df_edited <- rownames_to_column(df_edited, var = "Years")
df_rounded <- df_edited %>%
mutate(across(where(is.numeric), ~ round(.x, 2)))
write_csv(df_rounded, here("datasets", "comparedmatrix.csv"))
comp_plot
ggsave(here("plots", "comparison_plot.png"),
plot=comp_plot,
bg = "white")
